---
import { Image } from "astro:assets";
import { urlFor } from "../../lib/sanity";
import type { SanityCar } from "../../types";

interface Props {
    relatedCars: SanityCar[];
}

const { relatedCars } = Astro.props;

function formatPrice(price: number) {
    if (price >= 1000000) {
        // e.g. 2500000 -> 2.5
        const value = price / 1000000;
        return value % 1 === 0 ? `${value}jt` : `${value.toFixed(1)}jt`;
    } else if (price >= 1000) {
        // e.g. 350000 -> 350
        return `${Math.floor(price / 1000)}rb`;
    }
    return price.toLocaleString("id-ID");
}
---

<section
    class="lg:mt-16 mb-24 lg:mb-12 border-t border-gray-100 lg:border-none pt-8 lg:pt-0"
>
    <div
        class="flex justify-between items-center lg:items-end mb-4 lg:mb-8 px-5 lg:px-0"
    >
        <div>
            <h2 class="text-lg lg:text-2xl font-bold text-primary">
                Rekomendasi Armada Lainnya
            </h2>
            <p class="hidden lg:block text-[#6a7381] text-sm mt-1">
                Pilihan alternatif terbaik untuk perjalanan Anda.
            </p>
        </div>
        <a
            class="text-xs lg:text-sm font-bold text-primary hover:underline flex items-center gap-1"
            href="/armada"
        >
            Lihat Semua
            <span class="hidden lg:inline material-symbols-outlined !text-sm"
                >arrow_forward</span
            >
        </a>
    </div>

    <!-- Mobile Horizontal Scroll / Desktop Grid -->
    <div
        class="flex lg:grid lg:grid-cols-3 overflow-x-auto lg:overflow-visible gap-4 lg:gap-8 pb-4 lg:pb-0 snap-x hide-scrollbar px-5 lg:px-0"
    >
        {
            relatedCars.map((relatedCar) => (
                <a
                    href={`/armada/${relatedCar.slug.current}`}
                    class="flex-none w-64 lg:w-auto snap-start bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden group hover:shadow-md transition-shadow cursor-pointer"
                >
                    <div class="aspect-[4/3] overflow-hidden">
                        {relatedCar.image && (
                            <Image
                                src={urlFor(relatedCar.image)
                                    .width(400)
                                    .height(300)
                                    .url()}
                                alt={relatedCar.name}
                                width={400}
                                height={300}
                                class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
                            />
                        )}
                    </div>
                    <div class="p-4 lg:p-5">
                        <h3 class="text-sm lg:text-lg font-bold text-primary">
                            {relatedCar.name}
                        </h3>
                        <p class="text-[10px] lg:text-xs text-[#6a7381] mt-1 font-medium hidden lg:block">
                            {relatedCar.year
                                ? `Tahun ${relatedCar.year}`
                                : "Unit Terbaru"}{" "}
                            â€¢ {relatedCar.transmission || "Automatic"}
                        </p>

                        <div class="hidden lg:flex items-center gap-4 mt-4 text-[#6a7381]">
                            <div class="flex items-center gap-1.5">
                                <span class="material-symbols-outlined text-primary !text-lg">
                                    group
                                </span>
                                <span class="text-xs">
                                    {relatedCar.capacity} Orang
                                </span>
                            </div>
                            <div class="flex items-center gap-1.5">
                                <span class="material-symbols-outlined text-primary !text-lg">
                                    luggage
                                </span>
                                <span class="text-xs">
                                    {relatedCar.luggage || "1"} Koper
                                </span>
                            </div>
                        </div>

                        <div class="mt-2 lg:mt-6 flex justify-between items-center pt-0 lg:pt-4 lg:border-t lg:border-dashed lg:border-gray-100">
                            <div>
                                <p class="text-[10px] text-[#6a7381] hidden lg:block">
                                    Mulai dari
                                </p>
                                <p class="text-[12px] lg:text-lg font-bold text-primary">
                                    Rp{" "}
                                    {relatedCar.pricePerDay
                                        ? formatPrice(relatedCar.pricePerDay)
                                        : "Hubungi Kami"}
                                    <span class="lg:hidden font-normal text-xs text-[#6a7381]">
                                        /hari
                                    </span>
                                </p>
                            </div>
                            <div class="hidden lg:flex h-9 px-4 rounded-lg bg-primary/5 text-primary text-xs font-bold group-hover:bg-primary group-hover:text-white transition-colors items-center justify-center">
                                Lihat Detail
                            </div>
                        </div>
                    </div>
                </a>
            ))
        }
    </div>
</section>
